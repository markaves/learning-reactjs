Changing functions to state class